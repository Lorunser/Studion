@model Studion.ViewModels.NotesDisplayViewModel
@using Microsoft.AspNet.Identity

@{
    ViewBag.Title = "Display";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<div class="jumbotron">
    <h2>@Model.Note.Title</h2>
    <div class="row">
        <table class="table">
            <tr>
                <th>Author</th>
                <th>Subject</th>
                <th>Level</th>
                <th>Exam Board</th>
                <th>Uploaded</th>
                <th>Downloads</th>
                <th>Rating</th>
            </tr>
            <tr>
                <td>@Html.ActionLink(Model.Note.author.UserName, "ProfilePage", "Users", new { UserID = Model.Note.author.Id }, null)</td>
                <td>@Model.Note.subject.SubjectName</td>
                <td>@Model.Note.level.LevelName</td>
                <td>@Model.Note.examBoard.ExamBoardName</td>
                <td>@Model.Note.UploadTime.ToShortDateString()</td>
                <td>@Model.Note.Downloads</td>
                <td>@Model.Note.GetAvRating()</td>
            </tr>
        </table>
    </div>
    <div class="row">
        @Html.Partial("~/Views/Rating/_RatingPartial.cshtml");
    </div>
    @if (User.Identity.GetUserId() == Model.Note.AuthorID) //add logic for admin account
    {
        <div class="row">
            <div class="col-md-2 col-md-offset-2">
                <a class="btn btn-primary center-block" href="/Notes/Edit/@(Model.Note.NoteID)">Edit</a>
            </div>
            <div class="col-md-2 col-md-offset-4">
                <!--
                <a class="btn btn-danger center-block" href="/Notes/Delete/AT_SIGN(Model.Note.NoteID)">Delete</a>
                -->
                <button id="delete-button" data-note-id="@Model.Note.NoteID" class="btn btn-danger center-block">Delete</button>
            </div>
        </div>
    }
</div>



@{
    //document viewer
    @Html.Partial("~/Views/Notes/_DocumentViewerPartial.cshtml", Model.Note.NoteID);

    //comment list
    @Html.Partial("~/Views/Comment/_CommentPartial.cshtml", Model.Note.comments);

    //submit comment
    @Html.Partial("~/Views/Comment/_CommentFormPartial.cshtml", Model);
}

@section scripts
{
    <script>
        $(document).ready(function () {
            $("#delete-button").on("click", function () {
                var button = $(this);

                bootbox.confirm("Are you sure you want to delete this set of notes?", function (result) {
                    if (result) {
                        $.ajax({
                            url: "/api/notes/" + button.attr("data-note-id"),
                            method: "DELETE",
                            success: function () {
                                window.location = "/home";
                            }
                        });
                    }
                })
            });
        });
    </script>    
}
